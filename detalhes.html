<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meu Dividendo - Pesquisa de Ativos</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


  <link rel="stylesheet" href="css/global.css">  
  <link rel="stylesheet" href="css/calculadora.css">  

<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; color:#333; }
header { background:#1a202c; color:#fff; padding:16px; text-align:center; position: relative; }
#menu { position:absolute; left:16px; top:16px; cursor:pointer; font-size:1.5em; }
#searchContainer { text-align:center; margin:20px; }
#searchInput { padding:8px; font-size:1em; width:200px; }
#resultContainer { margin:20px; }
.card-horizontal { background:#1a202c; color:#fff; padding:16px 24px; border-radius:12px; text-align:center; min-width:300px; margin-bottom:12px; }
.grid-2x2 { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:12px; }
.card { background:#1a202c; color:#fff; padding:16px; border-radius:12px; text-align:center; }
.box { background:#fff; padding:16px; border-radius:12px; margin-bottom:20px; }
#historyChart { max-width:800px; margin:0 auto; }
.section-20 { display:flex; flex-wrap:wrap; gap:12px; justify-content:center; margin-bottom:40px; }
.section-20 .card { min-width:120px; font-size:0.9em; }
</style>
</head>
<body>

  

 <header>  
  <div class="menu" onclick="toggleMenu()">☰</div>    <h1 class="site-title">  
    <a href="index.html">Meu Dividendo</a>  
  </h1>    <nav id="menuLinks" class="menu-links">  
    <ul>  
      <li><a href="index.html">Início</a></li>  
                        <li><a href="paginadecalculadoras.html">Calculadoras</a></li>  
      <li><a href="curso-investimento.html">Curso de Investimento</a></li>  

<li><a href="feeddenoticias.html">Noticias</a></li>  </ul>
<
  </nav>  
</header> 



<div id="searchContainer">
  <input type="text" id="searchInput" placeholder="Digite o código do ativo (ex: PETR4.SA ou MXRF11)">
  <button onclick="buscarAtivo()">Buscar</button>
</div>

<div id="resultContainer"></div>

<div>
  <h3 style="text-align:center;">20 Mais Ações</h3>
  <div id="topAcoes" class="section-20"></div>
</div>

<div>
  <h3 style="text-align:center;">20 Mais FIIs</h3>
  <div id="topFiis" class="section-20"></div>
</div>

<script>
const ALPHA_KEY = "IV5PKYLN6WQK6FKW";
const BRAPI_KEY = "iTFTqSn6W2cyuHNrhcM2rJ";

// Mock 20 mais - exemplo, você pode atualizar via Brapi Github
const topAcoesLista = ["PETR4.SA","VALE3.SA","ITUB4.SA","BBDC4.SA","ABEV3.SA","BBAS3.SA","WEGE3.SA","MGLU3.SA","LREN3.SA","RENT3.SA","GGBR4.SA","SUZB3.SA","USIM5.SA","RAIL3.SA","VVAR3.SA","HYPE3.SA","COGN3.SA","B3SA3.SA","ELET3.SA","ENBR3.SA"];


const topFiisLista = ["MXRF11","HGLG11","KNRI11","BCFF11","RBRP11","XPML11","HGRE11","VLOL11","FIIB11","RECT11","KNCR11","HGBS11","HFOF11","VRTA11","ALZR11","GGRC11","BTLG11","HCTR11","IRDM11","GGRC11"];

let chartInstance;

function formatBRL(v){ return parseFloat(v).toLocaleString('pt-BR',{style:'currency',currency:'BRL'}); }
function formatNum(v){ return parseFloat(v).toLocaleString('pt-BR',{minimumFractionDigits:2,maximumFractionDigits:2}); }

async function fetchAlpha(symbol){
  try {
    const res = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${ALPHA_KEY}`);
    const data = await res.json();
    if(data["Global Quote"] && Object.keys(data["Global Quote"]).length) return data["Global Quote"];
  } catch(e){console.log(e);}
  return null;
}

async function fetchBrapi(symbol, key=false){
  try {
    const url = key
      ? `https://brapi.dev/api/quote/${symbol}?token=${BRAPI_KEY}`
      : `https://brapi.dev/api/quote/${symbol}`;
    const res = await fetch(url);
    const data = await res.json();
    if(data.results && data.results.length) return data.results[0];
  } catch(e){console.log(e);}
  return null;
}

async function buscarAtivo(){
  const query = document.getElementById('searchInput').value.trim().toUpperCase();
  if(!query) return alert("Digite um ativo!");
  const resultDiv = document.getElementById('resultContainer');
  resultDiv.innerHTML = '';

  const isFii = query.endsWith("11");
  let ativo = null;

  if(!isFii){
    ativo = await fetchAlpha(query) || await fetchBrapi(query,false) || await fetchBrapi(query,true);
  } else {
    ativo = await fetchBrapi(query,true);
  }

  if(!ativo) return alert("Ativo não encontrado ou indisponível!");

  // Cards layout
  const symbol = isFii ? ativo.stock ? ativo.stock : query : ativo["01. symbol"] || ativo.symbol;
  const preco = parseFloat(ativo["05. price"] || ativo.regularMarketPrice || 0);
  const abertura = parseFloat(ativo["02. open"] || ativo.regularMarketOpen || 0);
  const maxima = parseFloat(ativo["03. high"] || ativo.regularMarketDayHigh || 0);
  const minima = parseFloat(ativo["04. low"] || ativo.regularMarketDayLow || 0);
  const volume = parseInt(ativo["06. volume"] || ativo.regularMarketVolume || 0);
  const variacao = (ativo["10. change percent"] || ativo.changePercent || "0") ;

  // Card grande horizontal
  const cardH = document.createElement('div');
  cardH.className='card-horizontal';
  cardH.innerHTML=`<strong>${symbol}</strong><br>${formatBRL(preco)}<br><small>${new Date().toLocaleDateString()}</small>`;
  resultDiv.appendChild(cardH);

  // Grid 2x2
  const grid = document.createElement('div');
  grid.className='grid-2x2';
  [["Abertura",abertura],["Máxima",maxima],["Mínima",minima],["Variação",variacao]].forEach(([k,v])=>{
    const c = document.createElement('div');
    c.className='card';
    c.innerHTML=`<strong>${k}</strong><br>${typeof v==="number"?formatBRL(v):v}`;
    grid.appendChild(c);
  });
  resultDiv.appendChild(grid);

  // Caixa clara volume + gráfico
  const box = document.createElement('div');
  box.className='box';
  box.innerHTML=`<strong>Volume:</strong> ${volume.toLocaleString('pt-BR')}<br>`;
  const canvas = document.createElement('canvas');
  canvas.id='chartBox';
  box.appendChild(canvas);
  resultDiv.appendChild(box);

  if(chartInstance) chartInstance.destroy();
  const ctx = document.getElementById('chartBox').getContext('2d');
  chartInstance = new Chart(ctx,{
    type:'line',
    data:{
      labels:["Abertura","Máxima","Mínima","Fechamento"],
      datasets:[{
        label:`${symbol}`,
        data:[abertura,maxima,minima,preco],
        borderColor:'blue',
        backgroundColor:'rgba(0,0,255,0.2)',
        fill:true
      }]
    },
    options:{responsive:true, plugins:{legend:{display:false}}}
  });

  carregarTop("topAcoes",topAcoesLista,false);
  carregarTop("topFiis",topFiisLista,true);
}

// Função para carregar 20 mais
async function carregarTop(divId,list,isFii){
  const container = document.getElementById(divId);
  container.innerHTML='';
  for(const s of list){
    let ativo = null;
    if(!isFii){
      ativo = await fetchAlpha(s) || await fetchBrapi(s,false) || await fetchBrapi(s,true);
    } else {
      ativo = await fetchBrapi(s,true);
    }
    if(!ativo) continue;
    const symbol = isFii ? ativo.stock ? ativo.stock : s : ativo["01. symbol"] || ativo.symbol;
    const preco = parseFloat(ativo["05. price"] || ativo.regularMarketPrice || 0);
    const c = document.createElement('div');
    c.className='card';
    c.innerHTML=`${symbol}<br>${formatBRL(preco)}`;
    container.appendChild(c);
  }
}

// Carrega top fixos ao iniciar
carregarTop("topAcoes",topAcoesLista,false);
carregarTop("topFiis",topFiisLista,true);
</script>

 <footer>  
  <p>© 2026 Meu Dividendo</p>  
  <p>Conteúdo educativo. Resultados são estimativas e não recomendação financeira.</p>  
  <p><a href="politica-de-privacidade.html" style="color:#fff; text-decoration:underline;">Política de Privacidade</a></p>  
</footer> 

  <script>  
function toggleMenu() {  
  const menu = document.getElementById('menuLinks');  
  menu.style.display = menu.style.display === 'block' ? 'none' : 'block';  
}  
</script>  

<script src="js/calculadora-13salario.js"></script> 

</body>
</html>

