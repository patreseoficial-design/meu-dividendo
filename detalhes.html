<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta de Ações - Meu Dividendo</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; color:#333; }
  header { background:#000; color:#fff; padding:16px; display:flex; align-items:center; justify-content:space-between; }
  header h1 { margin:0; font-size:1.2em; }
  .menu-btn { font-size:1.5em; cursor:pointer; }
  nav { display:none; position:absolute; top:60px; left:0; width:100%; background:#000; color:#fff; padding:10px; flex-direction:column; }
  nav a { color:#fff; text-decoration:none; padding:8px 0; }
  #searchContainer { text-align:center; margin:20px; }
  #searchInput { padding:8px; font-size:1em; width:200px; }
  #cards { display:flex; flex-wrap:wrap; gap:12px; justify-content:center; margin:20px; }
  .card { background:#000; color:#fff; padding:16px 24px; border-radius:12px; min-width:140px; text-align:center; }
  #chartContainer { width:90%; max-width:700px; margin:20px auto; background:#fff; padding:16px; border-radius:12px; }
  footer { background:#000; color:#fff; text-align:center; padding:12px; margin-top:20px; }
  .info-text { text-align:center; max-width:600px; margin:auto; font-size:0.9em; color:#555; }
</style>
</head>
<body>

<header>
  <h1>Meu Dividendo</h1>
  <div class="menu-btn" onclick="toggleMenu()"><i class="fas fa-bars"></i></div>
</header>
<nav id="menu">
  <a href="#">Home</a>
  <a href="#">Ações</a>
  <a href="#">FIIs</a>
  <a href="#">Contato</a>
</nav>

<div id="searchContainer">
  <input type="text" id="searchInput" placeholder="Digite o código da ação (ex: VALE3)">
  <button onclick="buscarAcao()">Buscar</button>
  <p class="info-text">Para ações brasileiras, a Alpha Vantage usa o sufixo <strong>.SA</strong>. Ele será adicionado automaticamente se você não colocar.</p>
</div>

<div id="cards"></div>

<div id="chartContainer">
  <canvas id="priceChart"></canvas>
</div>

<footer>
  © 2026 Meu Dividendo - Consulta de Ações
</footer>

<script>
const API_KEY = "IV5PKYLN6WQK6FKW";

function toggleMenu() {
  const nav = document.getElementById("menu");
  nav.style.display = nav.style.display === "flex" ? "none" : "flex";
}

async function buscarAcao() {
  const query = document.getElementById('searchInput').value.trim().toUpperCase();
  const cardsDiv = document.getElementById('cards');
  cardsDiv.innerHTML = '';

  if(!query) return alert("Digite um ativo!");

  const symbol = query.includes(".SA") ? query : query + ".SA";

  try {
    // Consulta dados atuais
    const res = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${API_KEY}`);
    const data = await res.json();

    if(!data["Global Quote"] || Object.keys(data["Global Quote"]).length === 0) {
      return alert("Ativo não encontrado ou limite de requisições atingido!");
    }

    const quote = data["Global Quote"];
    const info = {
      Papel: quote["01. symbol"],
      Preco: quote["05. price"],
      Abertura: quote["02. open"],
      Maximo: quote["03. high"],
      Minimo: quote["04. low"],
      Volume: quote["06. volume"],
      Data: quote["07. latest trading day"],
      Variacao: quote["10. change percent"]
    };

    // Exibe cards
    Object.keys(info).forEach(k => {
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `<strong>${k}</strong><br>${info[k]}`;
      cardsDiv.appendChild(div);
    });

    // Consulta histórico diário (gráfico)
    const resHist = await fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY_ADJUSTED&symbol=${symbol}&outputsize=compact&apikey=${API_KEY}`);
    const histData = await resHist.json();
    if(!histData["Time Series (Daily)"]) return;

    const dates = Object.keys(histData["Time Series (Daily)"]).slice(0,30).reverse();
    const prices = dates.map(d => parseFloat(histData["Time Series (Daily)"][d]["4. close"]));

    // Desenha gráfico
    const ctx = document.getElementById('priceChart').getContext('2d');
    if(window.chart) window.chart.destroy();
    window.chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: dates,
        datasets: [{
          label: `${symbol} - Preço de fechamento`,
          data: prices,
          borderColor: '#000',
          backgroundColor: 'rgba(0,0,0,0.1)',
          fill:true,
          tension:0.2
        }]
      },
      options: {
        responsive:true,
        plugins: { legend: { display:true } },
        scales: {
          y: { beginAtZero:false },
          x: { ticks: { maxRotation:45, minRotation:45 } }
        }
      }
    });

  } catch(err) {
    console.error(err);
    alert("Erro ao consultar a API.");
  }
}
</script>

</body>
</html>