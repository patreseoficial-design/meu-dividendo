<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Meu Dividendo - Alpha Vantage</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; color:#333; }
  header { background:#000; color:#fff; padding:16px; text-align:center; font-size:1.2em; position: sticky; top:0; z-index:1000; }
  nav { display:flex; justify-content:flex-start; align-items:center; padding:0 16px; background:#111; color:#fff; }
  #menu { font-size:1.5em; cursor:pointer; margin-right:12px; }
  #searchContainer { text-align:center; margin:20px; }
  #searchInput { padding:8px; font-size:1em; width:200px; }
  #cards { display:flex; flex-wrap:wrap; gap:12px; justify-content:center; margin:20px; }
  .card { background:#000; color:#fff; padding:16px 24px; border-radius:12px; text-align:center; }
  .card-horizontal { min-width:300px; }
  .card-grid { display:grid; grid-template-columns:repeat(2, 1fr); gap:12px; margin-top:12px; }
  canvas { max-width:100%; margin:20px auto; display:block; }
  footer { text-align:center; padding:16px; background:#000; color:#fff; margin-top:20px; }
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<header>
  <nav>
    <span id="menu">&#9776;</span> Meu Dividendo
  </nav>
</header>

<div id="searchContainer">
  <input type="text" id="searchInput" placeholder="Digite o código do ativo (ex: PETR4.SA ou AAPL)">
  <button onclick="buscarAtivo()">Buscar</button>
  <p style="margin-top:8px; font-size:0.9em; color:#555;">Para ações brasileiras use o sufixo <strong>.SA</strong> no código.</p>
</div>

<div id="cards"></div>

<canvas id="historicoChart"></canvas>

<footer>Meu Dividendo &copy; 2026</footer>

<script>
const apiKey = "IV5PKYLN6WQK6FKW";

function formatBRL(valor) {
  if(!valor) return "-";
  return parseFloat(valor).toLocaleString('pt-BR', { style:'currency', currency:'BRL' });
}

function buscarAtivo() {
  const query = document.getElementById('searchInput').value.trim().toUpperCase();
  const cardsDiv = document.getElementById('cards');
  cardsDiv.innerHTML = '';
  document.getElementById('historicoChart').getContext('2d').clearRect(0,0,500,300);

  if(!query) return alert("Digite um código de ativo!");

  fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${query}&apikey=${apiKey}`)
    .then(res => res.json())
    .then(data => {
      if(!data["Global Quote"] || Object.keys(data["Global Quote"]).length === 0) {
        return alert("Ativo não encontrado ou não disponível.");
      }

      const ativo = data["Global Quote"];
      const cards = [
        { title: "Papel", value: ativo["01. symbol"] },
        { title: "Data", value: ativo["07. latest trading day"] },
        { title: "Preço", value: formatBRL(ativo["05. price"]) },
        { title: "Abertura", value: formatBRL(ativo["02. open"]) },
        { title: "Máximo", value: formatBRL(ativo["03. high"]) },
        { title: "Mínimo", value: formatBRL(ativo["04. low"]) },
        { title: "Volume", value: parseInt(ativo["06. volume"]).toLocaleString('pt-BR') },
        { title: "Variação", value: parseFloat(ativo["10. change percent"]).toFixed(2) + "%" }
      ];

      // Card principal horizontal
      const cardMain = document.createElement('div');
      cardMain.className = 'card card-horizontal';
      cardMain.innerHTML = `<strong>${cards[0].title}:</strong> ${cards[0].value}<br><strong>${cards[1].title}:</strong> ${cards[1].value}`;
      cardsDiv.appendChild(cardMain);

      // Grid de 4 cards
      const grid = document.createElement('div');
      grid.className = 'card-grid';
      cards.slice(2).forEach(c => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `<strong>${c.title}</strong><br>${c.value}`;
        grid.appendChild(div);
      });
      cardsDiv.appendChild(grid);

      // Buscar histórico diário
      fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY_ADJUSTED&symbol=${query}&outputsize=compact&apikey=${apiKey}`)
        .then(res => res.json())
        .then(hist => {
          const series = hist["Time Series (Daily)"];
          if(!series) return;

          const labels = Object.keys(series).slice(0,30).reverse();
          const dataPoints = labels.map(d => parseFloat(series[d]["4. close"]));

          const ctx = document.getElementById('historicoChart').getContext('2d');
          new Chart(ctx, {
            type: 'line',
            data: { labels, datasets:[{ label:'Fechamento (R$)', data:dataPoints, borderColor:'#000', backgroundColor:'rgba(0,0,0,0.1)'}] },
            options: { responsive:true, plugins:{ legend:{ display:true } } }
          });
        });

    }).catch(err => console.error(err));
}
</script>

</body>
</html>