<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Notícia Financeira | Meu Dividendo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 900px;
  margin: auto;
  padding: 20px;
  line-height: 1.7;
  color: #222;
}
img {
  width: 100%;
  max-height: 420px;
  object-fit: cover;
  margin-bottom: 20px;
  border-radius: 6px;
}
.meta {
  color: #666;
  font-size: 14px;
  margin-bottom: 20px;
}
.loading {
  color: #777;
  font-style: italic;
}
</style>
</head>

<body>

<h1 id="titulo"></h1>
<div class="meta" id="meta"></div>
<img id="imagem" alt="">
<p id="conteudo" class="loading">Gerando artigo automaticamente…</p>

<script>
// ===================================================
// TOKEN HUGGING FACE (QUEBRADO PRO GITHUB NÃO BLOQUEAR)
// ===================================================
const HF_TOKEN =
  "hf_" +
  "CpcjKnVdvDLoqCuE" +
  "BICPKNNDKPWE" +
  "qfUWqk";

// ===================================================
// RECUPERA NOTÍCIA DO FEED
// ===================================================
const noticia = JSON.parse(localStorage.getItem("noticia"));

if (!noticia) {
  document.getElementById("conteudo").innerText =
    "Erro: nenhuma notícia encontrada. Volte para o feed.";
  throw new Error("Notícia não encontrada");
}

// ===================================================
// PREENCHE CABEÇALHO
// ===================================================
document.getElementById("titulo").innerText = noticia.headline || "Notícia Financeira";
document.getElementById("imagem").src = noticia.image || "";
document.getElementById("meta").innerText =
  `Fonte: ${noticia.source || "Mercado Financeiro"} · ${
    new Date(noticia.datetime * 1000).toLocaleDateString("pt-BR")
  }`;

// ===================================================
// CHAMADA HUGGING FACE (TRADUZ + GERA ARTIGO)
// ===================================================
fetch("https://api-inference.huggingface.co/models/google/mt5-small", {
  method: "POST",
  headers: {
    "Authorization": "Bearer " + HF_TOKEN,
    "Content-Type": "application/json"
  },
  body: JSON.stringify({
    inputs: `
Traduza para português do Brasil e escreva um artigo financeiro ORIGINAL,
bem estruturado (introdução, desenvolvimento e conclusão),
com linguagem clara, educativa e profissional.

Notícia original:
Título: ${noticia.headline}
Resumo: ${noticia.summary}
`
  })
})
.then(res => res.json())
.then(data => {

  let texto = "";

  if (Array.isArray(data) && data[0]?.generated_text) {
    texto = data[0].generated_text;
  } else if (data.generated_text) {
    texto = data.generated_text;
  } else if (data.error) {
    document.getElementById("conteudo").innerText =
      "Modelo carregando… aguarde alguns segundos e recarregue a página.";
    return;
  }

  document.getElementById("conteudo").classList.remove("loading");
  document.getElementById("conteudo").innerText =
    texto || "Não foi possível gerar o artigo no momento.";

})
.catch(err => {
  console.error(err);
  document.getElementById("conteudo").innerText =
    "Erro ao gerar o artigo.";
});
</script>

</body>
</html>